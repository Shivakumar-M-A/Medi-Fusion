<form id="add-prescription-form">
    <div class="form-group">
        <label for="patient_id">Patient ID</label>
        <input type="text" id="patient_id" name="patient_id" readonly required>
    </div>

    <div class="form-group">
        <label for="disease">Diagnosis/Disease</label>
        <input type="text" id="disease" name="disease" required placeholder="e.g., Common Cold, Hypertension">
    </div>

    <div class="form-group">
        <label for="text">Prescription Text</label>
        <textarea id="text" name="text" rows="6" placeholder="Write full prescription here (e.g., Paracetamol 500mg, twice a day for 3 days.)" required></textarea>
    </div>
    
    <button type="submit" id="submit-btn">Record Prescription</button>

    <div id="message" style="display: none;"></div>
    <a href="doctor_dashboard.html" class="back-link">‚Üê Back to Dashboard</a>
</form>

<script>
    // ... (omitted setup and token check) ...
    
    const form = document.getElementById('add-prescription-form');
    form.addEventListener('submit', async function (e) {
        e.preventDefault();
        
        const submitBtn = document.getElementById('submit-btn');
        const msgDiv = document.getElementById('message');
        
        // üõ†Ô∏è UPDATED: Simplified validation to only check for text
        if (!form.text.value) {
            alert("Please provide the prescription text.");
            return;
        }

        submitBtn.disabled = true;
        submitBtn.textContent = 'Submitting...';
        msgDiv.style.display = 'none';
        msgDiv.className = 'message';
        
        const formData = new FormData(form);
        
        // Remove the unused file entry just in case it's still being created
        formData.delete('file');

        try {
            const resp = await fetch('/api/prescription', { 
                method: 'POST', 
                body: formData,
                headers: {
                     'Authorization': `Bearer ${localStorage.getItem('token')}`
                }
            });

            const res = await resp.json();

            if(resp.ok && res.success) {
                // üõ†Ô∏è UPDATED: Removed reference to 'CID' since it's now internal/placeholder
                msgDiv.textContent = 'Prescription stored successfully on the blockchain!';
                msgDiv.classList.add('success');
                form.disease.value = '';
                form.text.value = '';
            } else {
                throw new Error(res.error || 'An unknown error occurred.');
            }
        } catch (error) {
            msgDiv.textContent = 'Error: ' + error.message;
            msgDiv.classList.add('error');
        } finally {
            msgDiv.style.display = 'block';
            submitBtn.disabled = false;
            submitBtn.textContent = 'Record Prescription';
        }
    });
</script>